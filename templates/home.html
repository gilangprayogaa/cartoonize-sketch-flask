<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',    filename='css/reset.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static',    filename='css/style.css') }}">
    <!-- <link rel="stylesheet" type="text/css" href="../static/css/reset.css"> -->
    <!-- <link rel="stylesheet" type="text/css" href="../static/css/style.css"> -->
    <title>Image Cartoonizing</title>
</head>
<body>
   
            <script>

                function statusChangeCallback(response) {  // Called with the results from FB.getLoginStatus().
                  console.log('statusChangeCallback');
                  console.log(response);                   // The current login status of the person.
                  if (response.status === 'connected') {   // Logged into your webpage and Facebook.
                    testAPI();  
                  } else {                                 // Not logged into your webpage or we are unable to tell.
                    document.getElementById('status').innerHTML = 'Please log ' +
                      'into this webpage.';
                  }
                }
              
              
                function checkLoginState() {               // Called when a person is finished with the Login Button.
                  FB.getLoginStatus(function(response) {   // See the onlogin handler
                    statusChangeCallback(response);
                  });
                }
              
              
                window.fbAsyncInit = function() {
                  FB.init({
                    appId      : '259791408434394',
                    cookie     : true,                     // Enable cookies to allow the server to access the session.
                    xfbml      : true,                     // Parse social plugins on this webpage.
                    version    : 'v8.0'           // Use this Graph API version for this call.
                  });
              
              
                  FB.getLoginStatus(function(response) {   // Called after the JS SDK has been initialized.
                    statusChangeCallback(response);        // Returns the login status.
                  });
                };
               
                function testAPI() {                      // Testing Graph API after login.  See statusChangeCallback() for when this call is made.
                  console.log('Welcome!  Fetching your information.... ');
                  FB.api('/me', function(response) {
                    console.log('Successful login for: ' + response.name);
                    document.getElementById('status').innerHTML =
                      'Thanks for logging in, ' + response.name + '!';
                  });
                }
              
              </script>
              
<div class="main_div">
    <!-- The JS SDK Login Button -->
              
    <fb:login-button scope="public_profile,email" onlogin="checkLoginState();">
    </fb:login-button>
    
    <div id="status">
    </div>
    
    <!-- Load the JS SDK asynchronously -->
    <script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js"></script>

        
        <div class="container">
            <p>
                {% with messages = get_flashed_messages() %}
                  {% if messages %}
                    <ul class=flashes>
                    {% for message in messages %}
                      <li>{{ message }}</li>
                    {% endfor %}
                    </ul>
                  {% endif %}
                {% endwith %}
            </p>
            
            <form method="post" action="/img" enctype="multipart/form-data">
                <dl>
                    <p>
                        <input type="file" name="file" autocomplete="off" required>
                    </p>
                </dl>
                <p>
                    <input type="submit" value="Submit">
                </p>
            </form>
            
        </div>
        {% if filename %}
            <div class="image_wrapper">
                <img src="{{ url_for('display_image', filename=filename) }}">
            </div>
            {% endif %}
            <div
                class="fb-like"
                data-share="true"
                data-width="450"
                data-show-faces="true">
                </div>
                <div class="fb-share-button" data-href="https://image-cartoonizing.herokuapp.com/" data-layout="button_count" data-size="small"><a target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fimage-cartoonizing.herokuapp.com%2F&amp;src=sdkpreparse" class="fb-xfbml-parse-ignore">Share</a></div>
    </div>
    

</body>
</html>